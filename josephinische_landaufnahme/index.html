<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title>no.5 Seajax Utils Example</title>
    <style type="text/css">
      html, body {
        margin:0px;
        width:100%;
        height:100%;
        font-family: Verdana;
      }
    
      #viewer{
        width:100%;
        height:100%;
        margin:0px;
        color: white;   /* for error messages */
      }
    </style>

    <script type="text/javascript" src="js/seadragon-min.js"></script>

    <script type="text/javascript" src="js/raphael-min.js"></script>
    <script type="text/javascript" src="js/jquery-1.8.0.min.js"></script>
    <script type="text/javascript" src="js/seajax-utils.js"></script>

    <script type="text/javascript">
      var viewer;

      function onZoomitResponse(response) {
        if (response.error) {
          alert(response.error);
          return;
        }
     
        var content = response.content;
        if (content.ready) {
          viewer = new Seadragon.Viewer("viewer");
          viewer.addEventListener("open", addOverlays);
          viewer.openDzi(content.dzi);
        } else if (content.failed) {
          alert(content.url + " failed to convert.");
        } else {
          alert(content.url + " is " + Math.round(100 * content.progress) + "% done.");
        }
      }
 
      $.ajax({
        url: "http://api.zoom.it/v1/content/75hk",
        dataType: "jsonp",
        success: onZoomitResponse
      });
     		
      function addOverlays() {
        var ellipse = new No5.Seajax.Shapes.Ellipse(1500, 500);
        ellipse.attachTo(viewer, 2000, 800);
        ellipse.getElement().attr({"fill":"#0fff00", "stroke-color":"#ff0000"});
      
        // TODO introduce a mechanism that eliminates the need to do this...
        setTimeout(function() {
          ellipse.redraw(viewer);
        }, 500);
      }
    </script>
  </head>

  <body>
    <div id="viewer" width="100%" height="100%"></div>
  </body>
</html>
